<!DOCTYPE html>
<html lang="en-us">
    <head>
        <script data-ad-client="ca-pub-6244473643910448" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<meta name="google-site-verification" content="9qs7VjxtSrYMqw5OElxCdKv_gnssSRi6acB2iYlZnGA" />
<meta property="og:url" content="https://www.kaitoy.xyz/2016/07/11/windows_containers_on_tp5/">
<meta property="og:site_name" content="To Be Decided">
<meta name="twitter:card" content="summary"></meta>
<link rel="canonical" href="https://www.kaitoy.xyz/2016/07/11/windows_containers_on_tp5/">



  <meta property="og:type" content="article">
  <meta property="og:title" content="Windows Server 2016 TP5でWindows Containersにリトライ | To Be Decided">
  <title>Windows Server 2016 TP5でWindows Containersにリトライ | To Be Decided</title>
  <meta property="og:description" content="Windows Server 2016のTechnical Preview 5(TP5)が公開されていたので、
TP4でバグに阻まれて挫折した、Windows ContainersでPcap4Jを使ってパケットキャプチャする試みにリトライした話。">
  <meta name="description" content="Windows Server 2016のTechnical Preview 5(TP5)が公開されていたので、
TP4でバグに阻まれて挫折した、Windows ContainersでPcap4Jを使ってパケットキャプチャする試みにリトライした話。">
  <meta property="og:image" content="https://www.kaitoy.xyz/images/pcap4j-docker.png">



        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <style>

    html body {
        font-family: 'Noto Sans JP', sans-serif;
        background-color: #fefefe;
    }

    :root {
        --accent: #fa1e44;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://www.kaitoy.xyz/css/main.css">






<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
  var webFontConfig = {
    google: {
      families: ['Noto Sans JP:400,700:japanese'],
      active: function() {
        sessionStorage.fonts = true;
      }
    },
    timeout: 3000
  };
  WebFont.load(webFontConfig);
</script>


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/monokai.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 


    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>

    

    <script>hljs.initHighlightingOnLoad();</script>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>








<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.55.1" />
        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-65248565-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments)};
          gtag('js', new Date());

          gtag('config', 'UA-65248565-1');
        </script>
        
    </head>

    

    <body>
         
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v3.2"></script>

        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Windows Server 2016 TP5でWindows Containersにリトライ</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/post/">Posts</a></li>
                            
                                <li><a href="/tags/">Tags</a></li>
                            
                                <li><a href="/about/">About</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="mailto:kaitoy@pcap4j.org"><i class="fa fa-envelope-o"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/kaitoy"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/kaito-yamada-8558b913a"><i class="fa fa-linkedin"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.facebook.com/yamada.kaito.90"><i class="fa fa-facebook-square"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main>

    <div class="single-post">
        <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/07/11/windows_containers_on_tp5/">Windows Server 2016 TP5でWindows Containersにリトライ</a></h4>
    <h5>Mon, Jul 11, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/windows"><kbd class="item-tag">windows</kbd></a>
    

</div>


        <div class="cover">
            <a href="/2016/07/11/windows_containers_on_tp5/">
                <img src="https://www.kaitoy.xyz/images/pcap4j-docker.png" alt="Windows Server 2016 TP5でWindows Containersにリトライ">
            </a>
        </div>

        
        <h4 class="page-header">Table of Contents</h4>
        <aside>
            <nav id="TableOfContents">
<ul>
<li><a href="#osセットアップ">OSセットアップ</a></li>
<li><a href="#コンテナ機能のインストール">コンテナ機能のインストール</a></li>
<li><a href="#dockerインストール">Dockerインストール</a></li>
<li><a href="#コンテナイメージのインストール">コンテナイメージのインストール</a></li>
<li><a href="#pcap4jコンテナイメージのビルド">Pcap4Jコンテナイメージのビルド</a>
<ul>
<li><a href="#tp4からのアップデート">TP4からのアップデート</a></li>
<li><a href="#ビルドエラー-hcsshim-importlayer-failed-in-win32-the-filename-or-extension-is-too-long-0xce">ビルドエラー: hcsshim::ImportLayer failed in Win32: The filename or extension is too long. (0xce)</a></li>
<li><a href="#git-cloneできない">git cloneできない</a></li>
<li><a href="#未実装の機能">未実装の機能</a></li>
</ul></li>
<li><a href="#コンテナ起動">コンテナ起動</a>
<ul>
<li><a href="#コンテナ内でadministratorでコマンド実行したい">コンテナ内でAdministratorでコマンド実行したい</a></li>
<li><a href="#userコマンド">USERコマンド</a></li>
<li><a href="#userオプション">&ndash;userオプション</a></li>
<li><a href="#runas">runas</a></li>
<li><a href="#enter-pssession">Enter-PSSession</a></li>
</ul></li>
</ul>
</nav>
        </aside>
        <hr>
        

        <br> <div class="text-justify"><p><a href="https://www.microsoft.com/ja-jp/evalcenter/evaluate-windows-server-technical-preview">Windows Server 2016のTechnical Preview 5(TP5)が公開されていた</a>ので、
<a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/">TP4でバグに阻まれて挫折した</a>、Windows Containersで<a href="https://github.com/kaitoy/pcap4j">Pcap4J</a>を使ってパケットキャプチャする試みにリトライした話。</p>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6244473643910448"
     data-ad-slot="1845600530"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<h1 id="osセットアップ">OSセットアップ</h1>

<p><a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/#windows-containersセットアップ">TP4のとき</a>と同じ環境。</p>

<p>以降は<a href="https://msdn.microsoft.com/en-us/virtualization/windowscontainers/quick_start/quick_start_windows_server">Windows Server Containersのクイックスタートガイド</a>に沿ってセットアップを進める。
<a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/#windows-containersセットアップ">TP4</a>からは大分変わっていて、単一のPowershellスクリプトを実行する形式から、Powershellのコマンドレットを逐次手動実行する形式になっている。
面倒だけど何やってるかわかりやすくて好き。</p>

<h1 id="コンテナ機能のインストール">コンテナ機能のインストール</h1>

<ol>
<li><p>管理者権限のパワーシェルウィンドウを開く</p>

<p>コマンドプロンプトから以下のコマンドを実行。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">powershell start-process powershell -Verb runas</code></pre></div></li>

<li><p>コンテナ機能のインストール</p>

<p>開いた青いパワーシェルウィンドウで以下のコマンドを実行するとコンテナ機能がインストールされる。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">Install-WindowsFeature containers</code></pre></div>
<p>数分で終わる。</p>

<p>インストールされたのはHyper-V ContainersじゃなくてWindows Server Containersの方。
クイックスタートガイドをみると、前者がWindows 10向け、後者がWindows Server向けというように住み分けされているっぽい。TP4では両方ともWindows Serverで使えたんだけど。</p></li>

<li><p>再起動</p>

<p>変更を有効にするために再起動が必要。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#24909d">Restart-Computer</span> -Force</code></pre></div></li>
</ol>

<h1 id="dockerインストール">Dockerインストール</h1>

<p>Dockerは、コンテナイメージの管理やコンテナの起動などもろもろの機能を提供するDockerデーモンと、その機能を利用するためのCLIを提供するDockerクライアントからなる。この節ではそれら両方をインストールする。</p>

<ol>
<li><p>Dockerインストールフォルダ作成</p>

<p>管理者権限のパワーシェルウィンドウを開いて、以下のコマンドでDockerインストールフォルダを作成。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#24909d">New-Item</span> -Type Directory -Path <span style="color:#ed9d13">&#39;C:\Program Files\docker\&#39;</span></code></pre></div></li>

<li><p>Dockerデーモンインストール</p>

<p>まずはデーモンの方をインストール。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#24909d">Invoke-WebRequest</span> https<span style="color:#a61717;background-color:#e3d2d2">:</span>//aka.ms/tp5/b/dockerd -OutFile <span style="color:#40ffff">$env:ProgramFiles</span>\docker\dockerd.exe -UseBasicParsing</code></pre></div>
<p>数分。</p></li>

<li><p>Dockerクライアントインストール</p>

<p>次にクライアント。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#24909d">Invoke-WebRequest</span> https<span style="color:#a61717;background-color:#e3d2d2">:</span>//aka.ms/tp5/b/docker -OutFile <span style="color:#40ffff">$env:ProgramFiles</span>\docker\docker.exe -UseBasicParsing</code></pre></div>
<p>数十秒。</p></li>

<li><p>パスの設定</p>

<p>さっき作ったDockerインストールフォルダにパスを通す。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#40ffff">[Environment]</span>::SetEnvironmentVariable(<span style="color:#ed9d13">&#34;Path&#34;</span>, <span style="color:#40ffff">$env:Path</span> + <span style="color:#ed9d13">&#34;;C:\Program Files\Docker&#34;</span>, <span style="color:#40ffff">[EnvironmentVariableTarget]</span>::Machine)</code></pre></div></li>

<li><p>Dockerデーモンをサービスに登録</p>

<p>パスの設定を反映するためにいったんパワーシェルウィンドウとコマンドプロンプトを閉じて、
また管理者権限でパワーシェルウィンドウ開いて、以下のコマンドでDockerデーモンをサービスに登録する。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">dockerd --register-service</code></pre></div></li>

<li><p>Dockerデーモン起動</p>

<p>Dockerデーモンは以下のコマンドで起動できる。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#24909d">Start-Service</span> docker</code></pre></div>
<p>数秒で立ち上がる。
デフォルトではOS再起動時にはDockerデーモンは自動起動しないので、そのつどこのコマンドを実行する必要がある。</p></li>
</ol>

<p><br></p>

<p>これでDockerインストール完了。
この時点ではコンテナイメージは何もない。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Users\Administrator<span style="color:#999;font-style:italic">&gt;docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</code></pre></div>
<p>因みにインストールされたDockerのバージョンは1.12開発版。現時点での最新版だ。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Users\Administrator<span style="color:#999;font-style:italic">&gt;docker -v</span>
Docker version 1.12.0-dev, build 8e92415</code></pre></div>
<h1 id="コンテナイメージのインストール">コンテナイメージのインストール</h1>

<p>次に、コンテナイメージをインストールする。</p>

<ol>
<li><p>コンテナイメージのパッケージプロバイダをインストール</p>

<p>いまいち何なのかはよくわからないが、
コンテナイメージのパッケージプロバイダというのをインストールする。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">Install-PackageProvider ContainerImage -Force</code></pre></div>
<p>数十秒。</p></li>

<li><p>Windows Server Coreのイメージをインストール</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">Install-ContainerImage -Name WindowsServerCore</code></pre></div>
<p>9GB以上もあるファイルをダウンロードして処理するのでかなり時間がかかる。
50分くらいかかった。</p></li>

<li><p>Dockerデーモン再起動</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#24909d">Restart-Service</span> docker</code></pre></div></li>
</ol>

<p><br></p>

<p>無事Windows Server Coreイメージがインストールされた。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">PS C:\Users\Administrator<span style="color:#999;font-style:italic">&gt; docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
windowsservercore   10.0.14300.1000     5bc36a335344        8 weeks ago         9.354 GB</code></pre></div>
<h1 id="pcap4jコンテナイメージのビルド">Pcap4Jコンテナイメージのビルド</h1>

<p>以下を<code>C:\Users\Administrator\Desktop\pcap4j\Dockerfile</code>に書いて、<code>cd C:\Users\Administrator\Desktop\pcap4j</code>して、<code>docker build -t pcap4j .</code>を実行。
(Notepad使ったので、拡張子を表示する設定にして<code>Dockerfile</code>の<code>.txt</code>を消さないといけない罠があった。)</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#999;font-style:italic">#</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#999;font-style:italic"># Dockerfile for Pcap4J on Windows</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#999;font-style:italic">#</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">FROM</span><span style="color:#ed9d13"> windowsservercore:10.0.14300.1000</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">MAINTAINER</span><span style="color:#ed9d13"> Kaito Yamada &lt;kaitoy@pcap4j.org&gt;</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#999;font-style:italic"># Install Chocolatey.</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">RUN</span> mkdir C:<span style="color:#ed9d13">\p</span>cap4j<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">WORKDIR</span><span style="color:#ed9d13"> c:\\pcap4j</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">ADD</span><span style="color:#ed9d13"> https://chocolatey.org/install.ps1 install.ps1</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">RUN</span> powershell .<span style="color:#ed9d13">\i</span>nstall.ps1<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#999;font-style:italic"># Install dependencies.</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">RUN</span> choco install -y nmap jdk7 &amp;&amp; <span style="color:#ed9d13">\
</span><span style="color:#ed9d13"></span>    choco install -y maven -version <span style="color:#3677a9">3</span>.2.5<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#999;font-style:italic"># Build Pcap4J.</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">RUN</span> powershell -Command Invoke-WebRequest https://github.com/kaitoy/pcap4j/archive/v1.zip -OutFile pcap4j.zip &amp;&amp; <span style="color:#ed9d13">\
</span><span style="color:#ed9d13"></span>    powershell -Command Expand-Archive -Path pcap4j.zip -DestinationPath .<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">WORKDIR</span><span style="color:#ed9d13"> pcap4j-1</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">RUN</span> powershell -Command <span style="color:#ed9d13">&#34;mvn -P distribution-assembly install 2&gt;&amp;1 | Add-Content -Path build.log -PassThru&#34;</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#999;font-style:italic"># Collect libraries.</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">RUN</span> mkdir bin &amp;&amp; <span style="color:#ed9d13">\
</span><span style="color:#ed9d13"></span>    <span style="color:#24909d">cd</span> pcap4j-packetfactory-static &amp;&amp; <span style="color:#ed9d13">\
</span><span style="color:#ed9d13"></span>    mvn -DoutputDirectory=..<span style="color:#ed9d13">\b</span>in -Dmdep.stripVersion=<span style="color:#24909d">true</span> -DincludeScope=compile dependency:copy-dependencies &amp;&amp; <span style="color:#ed9d13">\
</span><span style="color:#ed9d13"></span>    mvn -DoutputDirectory=..<span style="color:#ed9d13">\b</span>in -Dmdep.stripVersion=<span style="color:#24909d">true</span> -DincludeGroupIds=ch.qos.logback dependency:copy-dependencies &amp;&amp; <span style="color:#ed9d13">\
</span><span style="color:#ed9d13"></span>    <span style="color:#24909d">cd</span> ../pcap4j-distribution &amp;&amp; <span style="color:#ed9d13">\
</span><span style="color:#ed9d13"></span>    mvn -DoutputDirectory=..<span style="color:#ed9d13">\b</span>in -Dmdep.stripVersion=<span style="color:#24909d">true</span> -DincludeArtifactIds=pcap4j-packetfactory-static,pcap4j-sample dependency:copy-dependencies<span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#999;font-style:italic"># Generate sample script. (C:\pcap4j\pcap4j-1\bin\capture.bat)</span><span style="color:#a61717;background-color:#e3d2d2">
</span><span style="color:#a61717;background-color:#e3d2d2"></span><span style="color:#6ab825;font-weight:bold">RUN</span> <span style="color:#24909d">echo</span> @echo off &gt; bin<span style="color:#ed9d13">\c</span>apture.bat &amp;&amp; <span style="color:#ed9d13">\
</span><span style="color:#ed9d13"></span>    <span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;%JAVA_HOME%\bin\java&#34;</span> -cp C:<span style="color:#ed9d13">\p</span>cap4j<span style="color:#ed9d13">\p</span>cap4j-1<span style="color:#ed9d13">\b</span>in<span style="color:#ed9d13">\p</span>cap4j-core.jar;C:<span style="color:#ed9d13">\p</span>cap4j<span style="color:#ed9d13">\p</span>cap4j-1<span style="color:#ed9d13">\b</span>in<span style="color:#ed9d13">\p</span>cap4j-packetfactory-static.jar;C:<span style="color:#ed9d13">\p</span>cap4j<span style="color:#ed9d13">\p</span>cap4j-1<span style="color:#ed9d13">\b</span>in<span style="color:#ed9d13">\p</span>cap4j-sample.jar;C:<span style="color:#ed9d13">\p</span>cap4j<span style="color:#ed9d13">\p</span>cap4j-1<span style="color:#ed9d13">\b</span>in<span style="color:#ed9d13">\j</span>na.jar;C:<span style="color:#ed9d13">\p</span>cap4j<span style="color:#ed9d13">\p</span>cap4j-1<span style="color:#ed9d13">\b</span>in<span style="color:#ed9d13">\s</span>lf4j-api.jar;C:<span style="color:#ed9d13">\p</span>cap4j<span style="color:#ed9d13">\p</span>cap4j-1<span style="color:#ed9d13">\b</span>in<span style="color:#ed9d13">\l</span>ogback-classic.jar;C:<span style="color:#ed9d13">\p</span>cap4j<span style="color:#ed9d13">\p</span>cap4j-1<span style="color:#ed9d13">\b</span>in<span style="color:#ed9d13">\l</span>ogback-core.jar org.pcap4j.sample.GetNextPacketEx &gt;&gt; bin<span style="color:#ed9d13">\c</span>apture.bat</code></pre></div>
<p><br></p>

<p>Dockerfileに書いた処理内容は<a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/#pcap4j-on-windows-container">TP4のとき</a>とだいたい同じ。
以下、Dockerfile書いているときに気付いたこと。</p>

<h2 id="tp4からのアップデート">TP4からのアップデート</h2>

<blockquote>
<p>WORKDIR や ENV や COPY でパスの区切りは \ 一つだと消えちゃうので \ か / を使わないといけない。
<div style="font-size: 0.5em; text-align: right;"><cite>引用元: <a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/#pcap4j-on-windows-container">TP4のときのエントリ</a></cite></div></p>
</blockquote>

<p><a href="https://msdn.microsoft.com/en-us/virtualization/windowscontainers/docker/manage_windows_dockerfile">このページ</a>の各コマンドの<strong>Windows Considerations</strong>に、<code>WORKDIR</code>のパスの区切りのバックスラッシュはエスケープしないといけないとか、<code>ADD</code>のパスの区切りはスラッシュじゃないといけないとか書いてある。
TP4のときはなかったような。</p>

<p><br></p>

<blockquote>
<p>WORKDIR や COPY のコンテナ内のパスに絶対パスを指定したい場合、C:\hoge、C:/hoge、C:\hoge、いずれもダメ。 以下の様なエラーが出る。
<div style="font-size: 0.5em; text-align: right;"><cite>引用元: <a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/#pcap4j-on-windows-container">TP4のときのエントリ</a></cite></div></p>
</blockquote>

<p>これは直った。<code>WORKDIR c:\\pcap4j</code>で行ける。</p>

<p><br></p>

<blockquote>
<p>install.ps1の中でChocolateyのインストーラをHTTPSで取ってこようとしてエラー
<div style="font-size: 0.5em; text-align: right;"><cite>引用元: <a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/#pcap4j-on-windows-container">TP4のときのエントリ</a></cite></div></p>
</blockquote>

<p>普通に<code>choco install</code>できたので、HTTPSが使えない制限は消えた模様。</p>

<p><br></p>

<blockquote>
<p>ビルドしてみると、各ステップの実行(多分レイヤの作成)がすごく遅い。
<div style="font-size: 0.5em; text-align: right;"><cite>引用元: <a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/#pcap4j-on-windows-container">TP4のときのエントリ</a></cite></div></p>
</blockquote>

<p>各ステップの実行は相変わらず重い。特にファイル変更が多いときはすごく重い。</p>

<p><br></p>

<blockquote>
<p>コンテナの起動は非常に遅い。30秒以上かかる。
<div style="font-size: 0.5em; text-align: right;"><cite>引用元: <a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/#windows-server-containers味見">TP4のときのエントリ</a></cite></div></p>
</blockquote>

<p>コンテナ起動は早くなったけどまだ5秒くらいかかる。</p>

<p><br></p>

<blockquote>
<p>WORKDIR や ENV で環境変数が展開されない。
<div style="font-size: 0.5em; text-align: right;"><cite>引用元: <a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/#pcap4j-on-windows-container">TP4のときのエントリ</a></cite></div></p>
</blockquote>

<p>これはまだ直っていない。<code>%tmp%</code>、<code>%TMP%</code>、<code>$TMP</code>、<code>${TMP}</code>、どれもだめ。</p>

<p><br></p>

<blockquote>
<p>コンテナ内で C:\ 直下に . で始まる名前のフォルダ作ると次のステップで消えてる。
<div style="font-size: 0.5em; text-align: right;"><cite>引用元: <a href="https://www.kaitoy.xyz/2016/01/22/pcap4j-meets-windows-containers/#pcap4j-on-windows-container">TP4のときのエントリ</a></cite></div></p>
</blockquote>

<p>これは再現しなかった。以前のも勘違いだったのかもしれない。
なんにせよデフォルトの.m2フォルダのパスが<code>C:\Users\ContainerAdministrator\.m2</code>になったので気にしなくてよくなった。</p>

<h2 id="ビルドエラー-hcsshim-importlayer-failed-in-win32-the-filename-or-extension-is-too-long-0xce">ビルドエラー: hcsshim::ImportLayer failed in Win32: The filename or extension is too long. (0xce)</h2>

<p><code>choco install</code>の後で以下のエラーが出た。</p>

<pre><code>re-exec error: exit status 1: output: time=&quot;2016-07-09T19:57:22-07:00&quot; level=error msg=&quot;hcsshim::ImportLayer failed in Win32: The filename or extension is too long. (0xce) layerId=\\\\?\\C:\\ProgramData\\docker\\windowsfilter\\103de6bf1358c506510ad67990f09ec3e2f10f9e866e846df5a88c04f5edf7aa flavour=1 folder=C:\\Windows\\TEMP\\hcs719016711&quot;
hcsshim::ImportLayer failed in Win32: The filename or extension is too long. (0xce) layerId=\\?\C:\ProgramData\docker\windowsfilter\103de6bf1358c506510ad67990f09ec3e2f10f9e866e846df5a88c04f5edf7aa flavour=1 folder=C:\Windows\TEMP\hcs719016711
</code></pre>

<p>調べたら<a href="https://github.com/docker/docker/issues/22449">DockerのGitHub Issues</a>に登録されていた。
ここのコメントを参考に以下のコマンドでコンテナホストのアップデートをしたら発生しなくなった。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#24909d">Invoke-WebRequest</span> https<span style="color:#a61717;background-color:#e3d2d2">:</span>//aka.ms/tp5/<span style="color:#24909d">Update-Container</span>-Host -OutFile <span style="color:#24909d">update-containerhost</span>.ps1
.\<span style="color:#24909d">update-containerhost</span>.ps1
<span style="color:#24909d">Restart-Computer</span> -Force</code></pre></div>
<h2 id="git-cloneできない">git cloneできない</h2>

<p>Pcap4Jのソースをダウンロードしたかったんだけど、なぜか<code>git clone</code>がHTTPSでもGITプロトコルでもエラーを返す。
原因を調べるのが面倒で結局zipでダウンロードするようにした。</p>

<h2 id="未実装の機能">未実装の機能</h2>

<p><a href="https://docs.docker.com/engine/reference/builder/">Dockerfileのリファレンス</a>に載っていて、Windows向けのサンプルも書いてあるのに、<a href="https://docs.docker.com/engine/reference/builder/#/escape">escapeディレクティブ</a>と<a href="https://docs.docker.com/engine/reference/builder/#/shell">SHELLコマンド</a>
が使えなかった。</p>

<h1 id="コンテナ起動">コンテナ起動</h1>

<p>とりあえず上記DockerfileでPcap4Jコンテナイメージのビルドはできた。</p>

<p>以下のコマンドでそのイメージからコンテナを起動。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Users\Administrator<span style="color:#999;font-style:italic">&gt;docker run -it pcap4j cmd</span></code></pre></div>
<p>コンテナ内で<code>ipconfig</code>すると<code>vEthernet (Temp Nic Name)</code>という名のネットワークインターフェースがあることがわかる。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\pcap4j\pcap4j-1\bin<span style="color:#999;font-style:italic">&gt;ipconfig</span>

Windows IP Configuration


Ethernet adapter vEthernet (Temp Nic Name):

   Connection-specific DNS Suffix  . : localdomain
   Link-local IPv6 Address . . . . . : fe80<span style="color:#999;font-style:italic">::59cf:1491:6f8e:30c8%18</span>
   IPv4 Address. . . . . . . . . . . : 172.23.71.6
   Subnet Mask . . . . . . . . . . . : 255.240.0.0
   Default Gateway . . . . . . . . . : 172.16.0.1</code></pre></div>
<p>けどPcap4Jからは見えなかった。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\pcap4j\pcap4j-1\bin<span style="color:#999;font-style:italic">&gt;capture.bat</span>
org.pcap4j.sample.GetNextPacketEx.count: 5
org.pcap4j.sample.GetNextPacketEx.readTimeout: 10
org.pcap4j.sample.GetNextPacketEx.snaplen: 65536


18:49<span style="color:#999;font-style:italic">:00.582 [main] INFO  org.pcap4j.core.Pcaps - No NIF was found.</span>
java.io.IOException: No NIF to capture.
        at org.pcap4j.sample.GetNextPacketEx.main(GetNextPacketEx.java:45)java:44)</code></pre></div>
<p><br></p>

<p>コンテナには<code>ContainerAdministrator</code>というユーザでログインしていて、これの権限が弱いせいなんじゃないかと。
コンテナ内にも<code>Administrator</code>というユーザがあるようだったので、こっちでコマンド実行するよう奮闘した。</p>

<h2 id="コンテナ内でadministratorでコマンド実行したい">コンテナ内でAdministratorでコマンド実行したい</h2>

<h2 id="userコマンド">USERコマンド</h2>

<p>Dockerfileのコマンドに<a href="https://docs.docker.com/engine/reference/builder/#/user">USER</a>というのがあるので、<code>USER Administrator</code>をDockerfileの末尾に追加してみたら以下のエラー。</p>

<pre><code>The daemon on this platform does not support the command 'user'
</code></pre>

<h2 id="userオプション">&ndash;userオプション</h2>

<p>docker runコマンドに<a href="https://docs.docker.com/compose/reference/run/">&ndash;user</a>というオプションがあるので以下のように試してみたところ、オプションは無視されて<code>ContainerAdministrator</code>でコンテナに入った。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">docker run -it --user Administrator pcap4j cmd</code></pre></div>
<h2 id="runas">runas</h2>

<p>ちょっと発想の転換をして、<code>ContainerAdministrator</code>でコンテナに入った後sudoみたいなことをすればいいかと思い、<a href="https://technet.microsoft.com/en-us/library/bb490994.aspx">runas</a>コマンドを試したけどだめだった。
よく分からないエラーがでるし、そもそも<code>Administrator</code>のパスワードがわからない。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\pcap4j\pcap4j-1\bin<span style="color:#999;font-style:italic">&gt;runas /user:Administrator cmd</span>
Enter the password for Administrator:
Attempting to start cmd as user <span style="color:#ed9d13">&#34;92EC7B3B09B4\Administrator&#34;</span> ...
RUNAS ERROR: Unable to run - cmd
1326: The<span style="color:#999;font-style:italic"> user name or password is incorrect.</span></code></pre></div><div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\pcap4j\pcap4j-1\bin<span style="color:#999;font-style:italic">&gt;runas /user:&#34;User Manager\Administrator&#34; capture.bat</span>
Enter the password for User Manager\Administrator:
RUNAS ERROR: Unable to acquire user password</code></pre></div>
<h2 id="enter-pssession">Enter-PSSession</h2>

<p>フォーラムに行ったら<a href="https://social.msdn.microsoft.com/Forums/en-US/0b6bd405-a235-4608-a06b-a09b9ba08b2e/runas-administrator?forum=windowscontainers">Enter-PSSession</a>を使う方法が書いてあった。</p>

<p><a href="https://technet.microsoft.com/en-us/library/hh849707.aspx">Enter-PSSession</a>はリモートシステムに接続するコマンドレットで、<code>-ContainerName</code>オプションを使えばコンテナにも接続できる。</p>

<p>試したら、コンテナが見つからないというエラーが出た。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Users\Administrator<span style="color:#999;font-style:italic">&gt;powershell -command Enter-PSSession -ContainerName amazing_archimedes -RunAsAdministrator</span>
Enter-PSSession : The<span style="color:#999;font-style:italic"> input ContainerName amazing_archimedes does not exist, or the corresponding container is not running.</span>
At line:1 char:1
+ Enter-PSSession -ContainerName amazing_archimedes -RunAsAdministrator
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation<span style="color:#999;font-style:italic">: (:) [Enter-PSSession], PSInvalidOperationException</span>
    + FullyQualifiedErrorId : CreateRemoteRunspaceForContainerFailed<span style="color:#999;font-style:italic">,Microsoft.PowerShell.Commands.EnterPSSessionCommand</span></code></pre></div>
<p><a href="https://technet.microsoft.com/en-us/library/hh849719.aspx">Invoke-Command</a>もコンテナをターゲットにできるので試してみたけど、同様のエラー。</p>

<p>どうもパワーシェルで扱うコンテナやコンテナイメージが、dockerコマンドが扱うものとは別になっているせいっぽい。
そんなことがTP4のときに見たドキュメントに書いてあったのを思い出した。(このドキュメントは消えてた。)</p>

<p>実際、<code>docker ps</code>では見えているコンテナが、</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Users\Administrator<span style="color:#999;font-style:italic">&gt;docker ps</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
a711497f29d8        pcap4j              <span style="color:#ed9d13">&#34;cmd&#34;</span>               13 minutes ago      Up 12 minutes                           amazing_archimedes</code></pre></div>
<p>コマンドレットからだと見えない。</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Users\Administrator<span style="color:#999;font-style:italic">&gt;powershell -command Get-Container</span>
WARNING: Based on customer feedback, we are updating the Containers PowerShell module to better align with Docker. As part of that some cmdlet and parameter names may change in future releases. To learn more about these changes as well as to join in the design process or provide usage feedback please refer to http://aka.ms/windowscontainers/powershell</code></pre></div>
<p>そうなると、パワーシェルのコマンドレットには<code>docker build</code>にあたるものがないのでもうどうしようもない。</p>

<p>そもそも、TP4の頃のコマンドレットは<a href="https://msdn.microsoft.com/en-us/virtualization/windowscontainers/management/docker-powershell">廃止になって</a>、<a href="https://github.com/Microsoft/Docker-PowerShell/">新しいコマンドレット</a>を開発中らしい。やはりdockerコマンドとコマンドレットでコンテナの相互運用ができない仕様にユーザから相当つっこみがあったようだ。</p>

<p><code>Enter-PSSession</code>や<code>Invoke-Command</code>の<code>-ContainerName</code>オプションもその内修正されるであろう。
それまで待つか。</p></div>

        <section class="share-buttons">
          <div class="share-button">
            <div class="fb-share-button" data-href="https://www.kaitoy.xyz/2016/07/11/windows_containers_on_tp5/" data-layout="box_count" data-size="small"><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.kaitoy.xyz%2f2016%2f07%2f11%2fwindows_containers_on_tp5%2f&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a></div>
          </div>
          <div class="share-button">
            <a class="twitter-share-button"
              href="https://twitter.com/intent/tweet?text=Windows%20Server%202016%20TP5%e3%81%a7Windows%20Containers%e3%81%ab%e3%83%aa%e3%83%88%e3%83%a9%e3%82%a4&amp;url=https%3a%2f%2fwww.kaitoy.xyz%2f2016%2f07%2f11%2fwindows_containers_on_tp5%2f"
              data-size="large">
            Tweet</a>
          </div>
          <div class="share-button">
            <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-normal" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/v4/public/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
          </div>
          <div class="share-button">
            <a data-pocket-label="pocket" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
            <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
          </div>
        </section>
    </div>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-6244473643910448"
         data-ad-slot="1845600530"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <section class="tbd-pagination">
      <div class="row">
        <div class="col-sm-6">
          <div class="prev">
            
            <a href="https://www.kaitoy.xyz/2016/07/01/https-support-by-cloudflare/">
              <i class="fa fa-angle-left"></i>
              CloudflareでブログをHTTPS化
            </a>
            
          </div>
        </div>
        <div class="col-sm-6">
          <div class="next text-right">
            
            <a href="https://www.kaitoy.xyz/2016/07/31/docker-for-windows/">
              Docker for Windowsがコレジャナかった
              <i class="fa fa-angle-right"></i>
            </a>
            
          </div>
        </div>
      </div>
    </section>

    
    

    

        <h4 class="page-header">Related</h4>

        <div class="related-links">
           <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2020/12/06/cri-dockerd/">Kubernetesでdockershimが廃止されても、KubernetesでDockerが使えなくなるわけじゃないよ</a></h4>
    <h5>Sun, Dec 6, 2020</h5>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2019/07/27/introduction-to-k8s/">Kubernetes入門</a></h4>
    <h5>Sat, Jul 27, 2019</h5>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/microservices"><kbd class="item-tag">microservices</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2019/06/15/k8s-ecosystem-container-runtimes/">Kubernetesのエコシステム ー コンテナランタイム編</a></h4>
    <h5>Sat, Jun 15, 2019</h5>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/containerd"><kbd class="item-tag">containerd</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2018/06/17/packer-k8s/">Packer &#43; Ansible on Windows 10でKubernetes 1.10のクラスタ on VirtualBoxを全自動構築</a></h4>
    <h5>Sun, Jun 17, 2018</h5>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/ansible"><kbd class="item-tag">ansible</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/packer"><kbd class="item-tag">packer</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/msys2"><kbd class="item-tag">msys2</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2018/06/03/build-k8s-cluster-by-ansible/">Kubernetes 1.10のクラスタを全手動で構築するのをAnsibleで全自動化した</a></h4>
    <h5>Sun, Jun 3, 2018</h5>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/ansible"><kbd class="item-tag">ansible</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2018/05/05/kubernetes-kubelet-config-and-pod-sec-policy/">Kubernetes 1.10のkubeletの起動オプションをKubelet ConfigファイルとPodSecurityPolicyで置き換える</a></h4>
    <h5>Sat, May 5, 2018</h5>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2018/05/04/kubernetes-with-weave-net/">Kubernetes 1.10のクラスタにWeave Netをデプロイする</a></h4>
    <h5>Fri, May 4, 2018</h5>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2018/04/17/kubernetes110-from-scratch/">Kubernetes 1.10をスクラッチから全手動で構築</a></h4>
    <h5>Tue, Apr 17, 2018</h5>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2018/04/01/hello-skaffold/">Skaffoldを触ってみた</a></h4>
    <h5>Sun, Apr 1, 2018</h5>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/skaffold"><kbd class="item-tag">skaffold</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/minikube"><kbd class="item-tag">minikube</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2017/10/31/retry-dashboard-on-k8s-cluster-by-kubeadm/">Kubernetes 1.8のアクセス制御について。あとDashboard。</a></h4>
    <h5>Tue, Oct 31, 2017</h5>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2017/10/21/build-kubernetes-cluster-by-kubeadm/">Kubernetes1.8のクラスタを構築する。kubeadmで。</a></h4>
    <h5>Sat, Oct 21, 2017</h5>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/kubeadm"><kbd class="item-tag">kubeadm</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2017/10/11/goslings-on-kubernetes-cont/">Kubernetesのチュートリアルをやる</a></h4>
    <h5>Wed, Oct 11, 2017</h5>
    
    <a href="https://www.kaitoy.xyz/tags/goslings"><kbd class="item-tag">goslings</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/minikube"><kbd class="item-tag">minikube</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2017/10/10/goslings-on-kubernetes/">Kubernetes 1.8が出たので、Minikubeを触ってみる</a></h4>
    <h5>Tue, Oct 10, 2017</h5>
    
    <a href="https://www.kaitoy.xyz/tags/goslings"><kbd class="item-tag">goslings</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/kubernetes"><kbd class="item-tag">kubernetes</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/minikube"><kbd class="item-tag">minikube</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2017/08/14/webdriverio-chrome/">WebdriverIOとChromeのヘッドレスモードで自動ブラウザテストするDockerイメージ: webdriverio-chrome</a></h4>
    <h5>Mon, Aug 14, 2017</h5>
    
    <a href="https://www.kaitoy.xyz/tags/servicenow"><kbd class="item-tag">servicenow</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/selenium"><kbd class="item-tag">selenium</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/webdriverio"><kbd class="item-tag">webdriverio</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/11/19/pcap4j-doesnt-work-on-bow-yet/">Currently Pcap4J Doesn&#39;t Work on Bash on Windows</a></h4>
    <h5>Sat, Nov 19, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/bow"><kbd class="item-tag">bow</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/windows"><kbd class="item-tag">windows</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/11/19/bow-do-not-change-linux-files-from-windows/">Bash on WindowsでWindows側からUbuntu側のファイルをいじると壊れることがあるので注意</a></h4>
    <h5>Sat, Nov 19, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/bow"><kbd class="item-tag">bow</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/windows"><kbd class="item-tag">windows</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/09/15/pcap4j-on-hyper-v-container-on-win10/">Pcap4J on Nano Server on Hyper-V Containers on Windows 10 on VMware Playerにトライ</a></h4>
    <h5>Thu, Sep 15, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/windows"><kbd class="item-tag">windows</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/nanoserver"><kbd class="item-tag">nanoserver</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/09/12/unzip-on-nanoserver/">Hyper-Vコンテナ(Nano Server)でunzipしたいならjarを使え</a></h4>
    <h5>Mon, Sep 12, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/windows"><kbd class="item-tag">windows</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/nanoserver"><kbd class="item-tag">nanoserver</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/08/21/an-encouragement-of-open-sourcing/">オープンソースプロジェクトのすゝめ</a></h4>
    <h5>Sun, Aug 21, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/github"><kbd class="item-tag">github</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/07/31/docker-for-windows/">Docker for Windowsがコレジャナかった</a></h4>
    <h5>Sun, Jul 31, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/windows"><kbd class="item-tag"> windows</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/04/16/pcap4j-in-kotlin/">Pcap4J in Kotlin</a></h4>
    <h5>Sat, Apr 16, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/kotlin"><kbd class="item-tag">kotlin</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/jvm-language"><kbd class="item-tag">jvm language</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/04/10/pcap4j-in-groovy/">Pcap4J in Groovy</a></h4>
    <h5>Sun, Apr 10, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/groovy"><kbd class="item-tag">groovy</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/jvm-language"><kbd class="item-tag">jvm language</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/03/19/zundoko-kiyoshi-with-pcap4j/"> ズンドコキヨシ with Pcap4J - ZUNDOKOプロトコルを実装してみた</a></h4>
    <h5>Sat, Mar 19, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/zundoko"><kbd class="item-tag">zundoko</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/01/22/pcap4j-meets-windows-containers/">Pcap4J Meets Windows Containers</a></h4>
    <h5>Fri, Jan 22, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/windows"><kbd class="item-tag">windows</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/01/12/pcap4j-with-four-native-libraries-on-windows10/">Pcap4J with Four Native Libraries on Windows 10</a></h4>
    <h5>Tue, Jan 12, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/windows"><kbd class="item-tag">windows</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2016/01/10/pcap-ng-support-in-pcap4j/">pcap-ng support in Pcap4J</a></h4>
    <h5>Sun, Jan 10, 2016</h5>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2015/12/03/software-quality-award-2015/">Pcap4JがSoftware Quality Award 2015で入賞</a></h4>
    <h5>Thu, Dec 3, 2015</h5>
    
    <a href="https://www.kaitoy.xyz/tags/yegor256"><kbd class="item-tag">yegor256</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2015/10/12/step-by-step-to-add-a-protocol-support-to-pcap4j-2/">Step by Step to Add a Protocol Support to Pcap4J (Part 2)</a></h4>
    <h5>Mon, Oct 12, 2015</h5>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2015/08/09/step-by-step-to-add-a-protocol-support-to-pcap4j-1/">Step by Step to Add a Protocol Support to Pcap4J (Part 1)</a></h4>
    <h5>Sun, Aug 9, 2015</h5>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2015/07/27/another-way-to-capture-lan-packets-with-pcap4j-container/">Another way to capture LAN packets with pcap4j container</a></h4>
    <h5>Mon, Jul 27, 2015</h5>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2015/07/25/how-to-capture-packets-on-a-local-network-with-pcap4j-container/">How to capture packets on a local network with Pcap4J container</a></h4>
    <h5>Sat, Jul 25, 2015</h5>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4 class="post-title"><a href="/2015/07/19/pcap4j-container-with-runc/">Pcap4J container with runC</a></h4>
    <h5>Sun, Jul 19, 2015</h5>
    
    <a href="https://www.kaitoy.xyz/tags/pcap4j"><kbd class="item-tag">pcap4j</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/runc"><kbd class="item-tag">runc</kbd></a>
    
    <a href="https://www.kaitoy.xyz/tags/docker"><kbd class="item-tag">docker</kbd></a>
    

</div>
 
        </div>
    

    

        <h4 class="page-header">Comments</h4>

        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kaitoy-tobedecided" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    

</main>

        <footer>

            <p class="copyright text-muted">&copy; 2015 Kaito Yamada. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a></p>

        </footer>

        <script>window.twttr = (function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
          if (d.getElementById(id)) return t;
          js = d.createElement(s);
          js.id = id;
          js.src = "https://platform.twitter.com/widgets.js";
          fjs.parentNode.insertBefore(js, fjs);

          t._e = [];
          t.ready = function(f) {
            t._e.push(f);
          };

          return t;
        }(document, "script", "twitter-wjs"));</script>

    </body>

</html>

